<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Контакты — Мебельный Дом</title>
<link rel="stylesheet" href="css/contacts.css">
</head>
<body>

<header class="site-header" role="banner">
  <div class="container">
    <div class="top-row">
      <div style="display:flex;align-items:center;gap:18px;min-width:0;">
        <div class="brand" id="brand" tabindex="0" title="Перейти на главную">
          <img src="./img/logo.png" alt="Логотип — Мебельный Дом" id="logo" />
          <div class="title">Мебельный Дом</div>
        </div>

        <nav class="nav-inline" aria-label="Основная навигация">
          <a href="index.html" class="nav-btn" data-page="home">Главная</a>
          <a href="catalog.html" class="nav-btn" data-page="catalog">Каталог</a>
          <a href="contacts.html" class="nav-btn" data-page="contacts" aria-current="page">Контакты</a>
          <a href="profile.html" class="nav-btn" data-page="profile">Профиль</a>
          <a href="cart.html" class="nav-btn" data-page="cart">Корзина</a>
        </nav>
      </div>

      <div class="controls" id="authControls">
        <!-- JS заполнит -->
      </div>
    </div>

    <nav class="mobile-nav" id="mobileNav" aria-label="Мобильная навигация">
      <a href="index.html" class="nav-btn" data-page="home">Главная</a>
      <a href="catalog.html" class="nav-btn" data-page="catalog">Каталог</a>
      <a href="contacts.html" class="nav-btn" data-page="contacts" aria-current="page">Контакты</a>
      <a href="profile.html" class="nav-btn" data-page="profile">Профиль</a>
    </nav>
  </div>
</header>

<!-- Модальное окно авторизации -->
<div class="auth-modal-overlay" id="authModal">
  <div class="auth-modal">
    <div class="auth-modal-header">
      <button class="auth-modal-tab active" data-tab="login">Вход</button>
      <button class="auth-modal-tab" data-tab="register">Регистрация</button>
    </div>
    
    <div class="auth-modal-content">
      <!-- Форма входа -->
      <form id="loginForm" style="display: block;">
        <div class="form-group">
          <label for="loginEmail" class="form-label">Email</label>
          <input type="email" id="loginEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword" class="form-label">Пароль</label>
          <input type="password" id="loginPassword" class="form-input" placeholder="Введите пароль" required>
        </div>
        
        <button type="submit" class="form-submit">Войти</button>
      </form>

      <form id="registerForm" style="display: none;">
        <div class="form-group">
          <label for="registerName" class="form-label">ФИО</label>
          <input type="text" id="registerName" class="form-input" placeholder="Иван Иванов" required>
        </div>
        
        <div class="form-group">
          <label for="registerPhone" class="form-label">Телефон</label>
          <input type="tel" id="registerPhone" class="form-input" placeholder="+7 (900) 000-00-00" required>
        </div>
        
        <div class="form-group">
          <label for="registerEmail" class="form-label">Email</label>
          <input type="email" id="registerEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="registerPassword" class="form-label">Пароль</label>
          <input type="password" id="registerPassword" class="form-input" placeholder="Придумайте пароль" required>
        </div>
        
        <div class="form-group">
          <label for="registerConfirmPassword" class="form-label">Подтвердите пароль</label>
          <input type="password" id="registerConfirmPassword" class="form-input" placeholder="Повторите пароль" required>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="privacyPolicy" class="checkbox" required>
          <label for="privacyPolicy" class="checkbox-label">
            Я соглашаюсь с <a href="#">политикой конфиденциальности</a> и даю согласие на обработку персональных данных
          </label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="dataStorage" class="checkbox" required>
          <label for="dataStorage" class="checkbox-label">
            Я соглашаюсь на хранение и обработку моих персональных данных
          </label>
        </div>
        
        <button type="submit" class="form-submit">Зарегистрироваться</button>
      </form>
    </div>
  </div>
</div>

<!-- Модальное окно для отзывов -->
<div class="review-modal-overlay" id="reviewModal">
  <div class="review-modal">
    <button class="review-modal-close" onclick="closeReviewModal()">&times;</button>
    <h2 class="review-modal-title">Оставить отзыв</h2>
    <p class="review-modal-subtitle">Поделитесь вашим мнением о нашей мебели и обслуживании</p>

    <form id="reviewForm">
      <div class="form-group">
        <label class="form-label">Оценка</label>
        <div class="rating-stars">
          <input type="radio" id="star5" name="rating" value="5" class="rating-input">
          <label for="star5" class="rating-label">★</label>
          <input type="radio" id="star4" name="rating" value="4" class="rating-input">
          <label for="star4" class="rating-label">★</label>
          <input type="radio" id="star3" name="rating" value="3" class="rating-input">
          <label for="star3" class="rating-label">★</label>
          <input type="radio" id="star2" name="rating" value="2" class="rating-input">
          <label for="star2" class="rating-label">★</label>
          <input type="radio" id="star1" name="rating" value="1" class="rating-input">
          <label for="star1" class="rating-label">★</label>
        </div>
      </div>

      <div class="form-group">
        <label for="reviewText" class="form-label">Текст отзыва</label>
        <textarea id="reviewText" class="form-input form-textarea" placeholder="Расскажите о вашем опыте покупки..." required></textarea>
      </div>

      <div id="reviewAuthMessage" class="auth-message" style="display: none;">
        <p>Чтобы оставить отзыв, пожалуйста <a href="javascript:void(0)" onclick="openAuthModal()">войдите</a> в аккаунт.</p>
      </div>

      <button type="submit" class="submit-btn" id="submitReviewBtn">Отправить отзыв</button>
    </form>
  </div>
</div>

<main class="container contacts-container">
  <div id="content">
    <div class="contacts-header">
      <h1 class="contacts-title">Контактная информация</h1>
      <p class="contacts-subtitle">Свяжитесь с нами удобным для вас способом</p>
    </div>

    <div class="contacts-grid">
      <!-- Контактная информация -->
      <div class="contact-info">
        <div class="info-item">
          <div class="info-label">Адрес</div>
          <div class="info-content">
            <p>г. Москва, Бутово, ул. Адмирала Лазарева, д. 63</p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-label">Телефон</div>
          <div class="info-content">
            <p>+7 (495) 123-45-67</p>
            <p>+7 (926) 987-65-43</p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-label">Email</div>
          <div class="info-content">
            <p>info@mebeldom.ru</p>
            <p>sales@mebeldom.ru</p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-label">Режим работы</div>
          <div class="info-content">
            <p>Пн-Пт: 9:00 - 20:00</p>
            <p>Сб-Вс: 10:00 - 18:00</p>
          </div>
        </div>

        <!-- Кнопка для открытия модального окна отзыва -->
        <div class="info-item">
          <button class="review-btn" onclick="openReviewModal()">Оставить отзыв</button>
        </div>
      </div>

    <!-- Правая колонка - Форма обратной связи -->
      <div class="contact-form">
        <h2 class="form-title">Напишите нам</h2>
        <p class="form-subtitle">Оставьте заявку и наши менеджеры свяжутся с вами в ближайшее время</p>

        <form id="contactForm">
          <div class="form-group">
            <label for="name" class="form-label">Ваше имя</label>
            <input type="text" id="name" class="form-input" placeholder="Иван Иванов" required>
          </div>

          <div class="form-group">
            <label for="phone" class="form-label">Телефон</label>
            <input type="tel" id="phone" class="form-input" placeholder="+7 ( )" required>
          </div>

          <div class="form-group">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-input" placeholder="example@mail.ru" required>
          </div>

          <div class="form-group">
            <label for="message" class="form-label">Сообщение</label>
            <textarea id="message" class="form-input form-textarea" placeholder="Расскажите, что вас интересует..."></textarea>
          </div>

          <button type="submit" class="submit-btn">Отправить заявку</button>
        </form>
      </div>
    </div>

    <!-- Яндекс карта -->
    <div class="map-section">
      <h3 class="map-title">Мы на карте</h3>
      <div id="map" class="map-container"></div>
    </div>

    <!-- Социальные сети -->
    <div class="social-section">
      <h3 class="social-title">Социальные сети</h3>
      <div class="social-links">
        <a href="#" class="social-link" aria-label="ВКонтакте">VK</a>
        <a href="#" class="social-link" aria-label="Telegram">TG</a>
        <a href="#" class="social-link" aria-label="WhatsApp">WA</a>
        <a href="#" class="social-link" aria-label="Instagram">IG</a>
        <a href="#" class="social-link" aria-label="YouTube">YT</a>
      </div>
    </div>
  </div>
</main>

<footer class="site-footer" role="contentinfo">
  <div class="footer-container">
    <!-- Контактная информация -->
    <div class="footer-section">
      <h4>Контакты</h4>
      <p><strong>Адрес:</strong><br>г. Москва, Бутово,<br>ул. Адмирала Лазарева, д. 63</p>
      <p><strong>Телефон:</strong><br><a href="tel:+74951234567">+7 (495) 123-45-67</a></p>
      <p><strong>Email:</strong><br><a href="mailto:info@mebeldom.ru">info@mebeldom.ru</a></p>
    </div>

    <!-- Режим работы -->
    <div class="footer-section">
      <h4>Режим работы</h4>
      <p><strong>Пн-Пт:</strong> 9:00 - 20:00</p>
      <p><strong>Сб-Вс:</strong> 10:00 - 18:00</p>
      <p>Без перерыва на обед</p>
    </div>

    <!-- Навигация -->
    <div class="footer-section">
      <h4>Навигация</h4>
      <ul>
        <li><a href="index.html">Главная</a></li>
        <li><a href="catalog.html">Каталог мебели</a></li>
        <li><a href="contacts.html">Контакты</a></li>
        <li><a href="about.html">О компании</a></li>
        <li><a href="delivery.html">Доставка и сборка</a></li>
      </ul>
    </div>

    <!-- Социальные сети -->
    <div class="footer-section">
      <h4>Мы в соцсетях</h4>
      <div class="social-links">
        <a href="https://vk.com/mebeldom" aria-label="ВКонтакте" target="_blank">VK</a>
        <a href="https://t.me/mebeldom" aria-label="Telegram" target="_blank">TG</a>
        <a href="https://wa.me/79991234567" aria-label="WhatsApp" target="_blank">WA</a>
        <a href="https://instagram.com/mebeldom" aria-label="Instagram" target="_blank">IG</a>
      </div>
      <p style="margin-top: 15px; font-size: 14px; color: #999;">
        Подписывайтесь на наши новости и акции
      </p>
    </div>

    <!-- Копирайт и юридическая информация -->
    <div class="footer-bottom">
      <div class="copyright">
        © 2025 ООО "Мебельный Дом". Все права защищены.<br>
        ИНН: 1234567890 | ОГРН: 1234567890123
      </div>
      <div class="legal-links">
        <a href="privacy.html">Политика конфиденциальности</a>
        <a href="terms.html">Пользовательское соглашение</a>
        <a href="return.html">Условия возврата</a>
      </div>
    </div>
  </div>
</footer>

<script src="https://api-maps.yandex.ru/2.1/?apikey=ваш_api_ключ&lang=ru_RU" type="text/javascript"></script>
<script src="js/auth.js"></script>
<script src="js/cart.js"></script>

<script>
// Функции для модального окна отзывов
function openReviewModal() {
  const reviewModal = document.getElementById('reviewModal');
  const authMessage = document.getElementById('reviewAuthMessage');
  const submitBtn = document.getElementById('submitReviewBtn');
  
  // Проверяем авторизацию
  if (!window.auth || !window.auth.isUserAuthenticated()) {
    authMessage.style.display = 'block';
    submitBtn.disabled = true;
  } else {
    authMessage.style.display = 'none';
    submitBtn.disabled = false;
  }
  
  reviewModal.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeReviewModal() {
  const reviewModal = document.getElementById('reviewModal');
  reviewModal.classList.remove('active');
  document.body.style.overflow = 'auto';
  // Сбрасываем форму
  const reviewForm = document.getElementById('reviewForm');
  if (reviewForm) {
    reviewForm.reset();
  }
}

// Основной код
(function(){
  const reviewForm = document.getElementById('reviewForm');

  // Обработчик формы отзыва
  // Обработчик формы отзыва
if (reviewForm) {
    reviewForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Проверяем авторизацию
      if (!window.auth || !window.auth.isUserAuthenticated()) {
        alert('Пожалуйста, войдите в систему чтобы оставить отзыв');
        closeReviewModal();
        window.openAuthModal();
        return;
      }

      const rating = document.querySelector('input[name="rating"]:checked');
      const text = document.getElementById('reviewText').value.trim();

      // Валидация
      if (!rating) {
        alert('Пожалуйста, выберите оценку');
        return;
      }

      if (!text) {
        alert('Пожалуйста, напишите текст отзыва');
        return;
      }

      // Подготавливаем данные для отправки
      const reviewData = {
        rating: parseInt(rating.value),
        text: text
      };

      console.log('Отправляемые данные:', reviewData); // Для отладки

      try {
        // Отправляем отзыв на сервер
        const token = window.auth.getAuthToken();
        const response = await fetch('http://localhost:8001/api/reviews', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(reviewData)
        });

        console.log('Статус ответа:', response.status); // Для отладки

        if (response.ok) {
          const result = await response.json();
          console.log('Успешный ответ:', result);
          alert('Спасибо! Ваш отзыв отправлен и будет опубликован после модерации.');
          closeReviewModal();
        } else {
          // Получаем детальную информацию об ошибке
          const errorText = await response.text();
          console.error('Текст ошибки:', errorText);
          
          let errorMessage = 'Не удалось отправить отзыв';
          try {
            const errorData = JSON.parse(errorText);
            errorMessage = errorData.detail || errorMessage;
          } catch (e) {
            errorMessage = `Ошибка ${response.status}: ${errorText}`;
          }
          
          alert('Ошибка: ' + errorMessage);
        }
      } catch (error) {
        console.error('Ошибка при отправке отзыва:', error);
        alert('Произошла ошибка при отправке отзыва: ' + error.message);
      }
    });
  }

  // Инициализация карты
  function initMap() {
    const addressCoords = [55.5411, 37.5205]; 
    
    if (typeof ymaps !== 'undefined') {
      ymaps.ready(function() {
        const map = new ymaps.Map('map', {
          center: addressCoords,
          zoom: 15,
          controls: ['zoomControl', 'fullscreenControl']
        });

        const placemark = new ymaps.Placemark(addressCoords, {
          balloonContent: `
            <strong>Мебельный Дом</strong><br/>
            г. Москва, Бутово, ул. Адмирала Лазарева, д. 63<br/>
            Телефон: +7 (495) 123-45-67
          `,
          hintContent: 'Мебельный Дом'
        }, {
          preset: 'islands#redIcon'
        });

        map.geoObjects.add(placemark);
        placemark.balloon.open();
      });
    }
  }

  // Обработчики закрытия модального окна
  document.addEventListener('click', function(e) {
    const reviewModal = document.getElementById('reviewModal');
    if (e.target === reviewModal) {
      closeReviewModal();
    }
  });

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeReviewModal();
    }
  });

  // Запуск инициализации карты
  if (typeof ymaps !== 'undefined') {
    initMap();
  } else {
    window.addEventListener('load', initMap);
  }
})();
</script>
</body>
</html>