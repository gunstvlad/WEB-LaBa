<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Мебельный магазин</title>
<link rel="stylesheet" href="css/index.css">
<style>
  /* Стили для слайдера ассортимента */
  .assortment-section {
    margin: 60px 0;
  }
  
  .assortment-section h3 {
    text-align: center;
    margin-bottom: 8px;
    color: #0f172a;
    font-size: 28px;
  }
  
  .assortment-lead {
    text-align: center;
    color: #64748b;
    margin-bottom: 40px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .assortment-slider {
    position: relative;
    max-width: 1000px;
    margin: 0 auto;
    overflow: hidden;
    border-radius: 12px;
  }
  
  .assortment-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }
  
  .product-slide {
    flex: 0 0 100%;
    padding: 20px;
    box-sizing: border-box;
    text-align: center;
    position: relative;
  }
  
  .product-image {
    width: 100%;
    max-width: 700px;
    height: 400px;
    object-fit: cover;
    border-radius: 8px;
    margin: 0 auto 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  
  .product-info {
    padding: 0 20px;
  }
  
  .product-name {
    font-size: 28px;
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 12px 0;
  }
  
  .product-description {
    color: #64748b;
    line-height: 1.6;
    margin: 0;
    font-size: 18px;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .assortment-controls {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    transform: translateY(-50%);
    z-index: 10;
  }
  
  .assortment-btn {
    background: rgba(255, 255, 255, 0.8);
    color: var(--brand-red);
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  
  .assortment-btn:hover {
    background: white;
    transform: scale(1.1);
  }
  
  .assortment-dots {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
  }
  
  .assortment-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #cbd5e1;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  
  .assortment-dot.active {
    background: var(--brand-red);
  }

  /* Стили для слайдера отзывов */
  .reviews-section {
    margin: 60px 0;
  }
  
  .reviews-section h3 {
    text-align: center;
    margin-bottom: 8px;
    color: #0f172a;
    font-size: 28px;
  }
  
  .reviews-lead {
    text-align: center;
    color: #64748b;
    margin-bottom: 40px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .reviews-slider {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
    overflow: hidden;
    border-radius: 12px;
  }
  
  .reviews-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }
  
  .review-slide {
    flex: 0 0 100%;
    padding: 30px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    box-sizing: border-box;
  }
  
  .review-header {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
  }
  
  .review-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #d77272;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
    margin-right: 16px;
  }
  
  .review-info {
    flex: 1;
  }
  
  .review-author {
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 4px 0;
  }
  
  .review-date {
    color: #64748b;
    font-size: 14px;
    margin: 0;
  }
  
  .review-rating {
    color: #f59e0b;
    font-size: 18px;
    margin-bottom: 12px;
  }
  
  .review-text {
    color: #475569;
    line-height: 1.6;
    margin: 0;
    font-style: italic;
  }
  
  .reviews-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
  }
  
  .reviews-btn {
    background: var(--brand-red);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s ease;
  }
  
  .reviews-btn:hover {
    background: #b3151a;
    transform: scale(1.1);
  }
  
  .reviews-btn:disabled {
    background: #cbd5e1;
    cursor: not-allowed;
    transform: none;
  }
  
  .reviews-dots {
    display: flex;
    gap: 8px;
  }
  
  .reviews-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #cbd5e1;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  
  .reviews-dot.active {
    background: var(--brand-red);
  }
  
  @media (max-width: 768px) {
    .product-slide {
      padding: 15px;
    }
    
    .product-image {
      height: 300px;
      max-width: 100%;
    }
    
    .product-name {
      font-size: 24px;
    }
    
    .assortment-btn {
      width: 40px;
      height: 40px;
      font-size: 20px;
    }
    
    .review-slide {
      padding: 20px;
    }
    
    .review-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .review-avatar {
      margin-right: 0;
      margin-bottom: 12px;
    }
  }
</style>
</head>
<body>

<header class="site-header" role="banner">
  <div class="container">
    <div class="top-row">
      <div style="display:flex;align-items:center;gap:18px;min-width:0;">
        <div class="brand" id="brand" tabindex="0" title="Перейти на главную">
          <img src="./img/logo.png" alt="Логотип — Мебельный Дом" id="logo" />
          <div class="title">Мебельный Дом</div>
        </div>

        <nav class="nav-inline" aria-label="Основная навигация">
            <a href="index.html" class="nav-btn" data-page="home" aria-current="page">Главная</a>
            <a href="catalog.html" class="nav-btn" data-page="catalog">Каталог</a>
            <a href="contacts.html" class="nav-btn" data-page="contacts">Контакты</a>
            <a href="profile.html" class="nav-btn" data-page="profile">Профиль</a>
            <a href="cart.html" class="nav-btn" data-page="cart">Корзина</a>
        </nav>
      </div>

      <div class="controls" id="authControls">
        <!-- JS заполнит -->
      </div>
    </div>

    <nav class="mobile-nav" id="mobileNav" aria-label="Мобильная навигация">
      <a href="index.html" class="nav-btn" data-page="home" aria-current="page">Главная</a>
      <a href="catalog.html" class="nav-btn" data-page="catalog">Каталог</a>
      <a href="contacts.html" class="nav-btn" data-page="contacts">Контакты</a>
      <a href="profile.html" class="nav-btn" data-page="profile">Профиль</a>
      <a href="cart.html" class="nav-btn" data-page="cart">Корзина</a>
    </nav>
  </div>
</header>

<!-- Модальное окно авторизации -->
<div class="auth-modal-overlay" id="authModal">
  <div class="auth-modal">
    <div class="auth-modal-header">
      <button class="auth-modal-tab active" data-tab="login">Вход</button>
      <button class="auth-modal-tab" data-tab="register">Регистрация</button>
    </div>
    
    <div class="auth-modal-content">
      <!-- Форма входа -->
      <form id="loginForm" style="display: block;">
        <div class="form-group">
          <label for="loginEmail" class="form-label">Email</label>
          <input type="email" id="loginEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword" class="form-label">Пароль</label>
          <input type="password" id="loginPassword" class="form-input" placeholder="Введите пароль" required>
        </div>
        
        <button type="submit" class="form-submit">Войти</button>
      </form>

      <form id="registerForm" style="display: none;">
        <div class="form-group">
          <label for="registerName" class="form-label">ФИО</label>
          <input type="text" id="registerName" class="form-input" placeholder="Иван Иванов" required>
        </div>
        
        <div class="form-group">
          <label for="registerPhone" class="form-label">Телефон</label>
          <input type="tel" id="registerPhone" class="form-input" placeholder="+7 (900) 000-00-00" required>
        </div>
        
        <div class="form-group">
          <label for="registerEmail" class="form-label">Email</label>
          <input type="email" id="registerEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="registerPassword" class="form-label">Пароль</label>
          <input type="password" id="registerPassword" class="form-input" placeholder="Придумайте пароль" required>
        </div>
        
        <div class="form-group">
          <label for="registerConfirmPassword" class="form-label">Подтвердите пароль</label>
          <input type="password" id="registerConfirmPassword" class="form-input" placeholder="Повторите пароль" required>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="privacyPolicy" class="checkbox" required>
          <label for="privacyPolicy" class="checkbox-label">
            Я соглашаюсь с <a href="#">политикой конфиденциальности</a> и даю согласие на обработку персональных данных
          </label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="dataStorage" class="checkbox" required>
          <label for="dataStorage" class="checkbox-label">
            Я соглашаюсь на хранение и обработку моих персональных данных
          </label>
        </div>
        
        <button type="submit" class="form-submit">Зарегистрироваться</button>
      </form>
    </div>
  </div>
</div>

<main class="container" style="padding:34px 18px;">
  <div id="content" style="margin-top:12px;padding:18px;background:white;border-radius:10px;box-shadow:0 6px 16px rgba(2,6,23,0.06);min-height:120px;">
    <!-- ===== About section ===== -->
    <section aria-label="О нас">
        <div class="about-row">
            <div class="about-text">
            <h3>О нас</h3>
            <p><strong>Мы — команда профессионалов</strong> с многолетним опытом в производстве качественной мебели. Каждое изделие создаётся с любовью к деталям и заботой о комфорте наших клиентов.</p>
            <p>Вы можете довериться нашему вкусу: мы постоянно развиваемся, совершенствуем процессы и используем только проверенные материалы. Наша цель — сделать ваш дом уютнее.</p>
            </div>

            <div class="about-card">
            <div class="about-image">
                <img src="./img/divan.png" alt="Диван" style="display:block;width:100%;height:auto;object-fit:cover;">
            </div>
            </div>
        </div>

        <!-- features -->
        <div class="features" role="region" aria-label="Наши преимущества">
            <div class="lead">
            <h4 style="margin:0 0 8px;color:#0f172a;font-size:16px">История</h4>
            <p style="margin:0;color:#64748b">Наша компания существует долгое время и за годы работы мы накопили опыт и знания, которые помогают создавать идеальную мебель для вашего дома.</p>
            </div>

            <div class="features-grid">
                <div class="feature g-blue" role="article" aria-label="Качество">
                    <div class="icon ic-blue">✓</div>
                    <div class="f-body">
                    <div class="f-title">Качество</div>
                    <div class="f-desc">Используем только лучшие материалы и строгий контроль на каждом этапе.</div>
                    </div>
                </div>

                <div class="feature g-purple" role="article" aria-label="Дизайн">
                    <div class="icon ic-purple">★</div>
                    <div class="f-body">
                    <div class="f-title">Дизайн</div>
                    <div class="f-desc">Современные и стильные решения — подберём вариант под ваш интерьер.</div>
                    </div>
                </div>

                <div class="feature g-green" role="article" aria-label="Сервис">
                    <div class="icon ic-green">❤</div>
                    <div class="f-body">
                    <div class="f-title">Сервис</div>
                    <div class="f-desc">Полное сопровождение: доставка, сборка и поддержка после покупки.</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== Team Section ===== -->
    <section class="team-section" aria-label="Наша команда">
        <h3>Наша команда</h3>
        <p class="lead">Люди, которые делают вашу мебель с любовью и вниманием к деталям</p>

        <div class="team-grid">
            <div class="team-card">
            <img src="./img/profile1.png" alt="Иван Иванов">
            <div class="team-info">
                <div class="team-name">Иван Иванов</div>
                <div class="team-role">Дизайнер интерьеров</div>
            </div>
            </div>

            <div class="team-card">
            <img src="./img/profile2.png" alt="Мария Петрова">
            <div class="team-info">
                <div class="team-name">Мария Петрова</div>
                <div class="team-role">Менеджер по продажам</div>
            </div>
            </div>

            <div class="team-card">
            <img src="./img/profile3.png" alt="Алексей Сидоров">
            <div class="team-info">
                <div class="team-name">Алексей Сидоров</div>
                <div class="team-role">Мастер-изготовитель</div>
            </div>
            </div>
        </div>
    </section>

    <!-- ===== Assortment Slider Section ===== -->
    <section class="assortment-section" aria-label="Наш ассортимент">
      <h3>Наш ассортимент</h3>
      <p class="assortment-lead">Ознакомьтесь с разнообразием нашей качественной мебели для вашего дома</p>
      
      <div class="assortment-slider">
        <div class="assortment-track" id="assortmentTrack">
          <!-- Слайды будут добавлены через JavaScript -->
        </div>
        <div class="assortment-controls">
          <button class="assortment-btn" id="assortmentPrevBtn" aria-label="Предыдущий товар">‹</button>
          <button class="assortment-btn" id="assortmentNextBtn" aria-label="Следующий товар">›</button>
        </div>
      </div>
      
      <div class="assortment-dots" id="assortmentDots">
        <!-- Точки навигации будут добавлены через JavaScript -->
      </div>
    </section>

    <!-- ===== Reviews Slider Section ===== -->
    <section class="reviews-section" aria-label="Отзывы клиентов">
      <h3>Отзывы наших клиентов</h3>
      <p class="reviews-lead">Узнайте, что говорят о нас люди, которые уже обустроили свой дом с нашей мебелью</p>
      
      <div class="reviews-slider">
        <div class="reviews-track" id="reviewsTrack">
          <!-- Отзывы будут добавлены через JavaScript -->
        </div>
      </div>
      
      <div class="reviews-controls">
        <button class="reviews-btn" id="reviewsPrevBtn" aria-label="Предыдущий отзыв">‹</button>
        
        <div class="reviews-dots" id="reviewsDots">
          <!-- Точки навигации будут добавлены через JavaScript -->
        </div>
        
        <button class="reviews-btn" id="reviewsNextBtn" aria-label="Следующий отзыв">›</button>
      </div>
    </section>
  </div>
</main>

<footer class="site-footer" role="contentinfo">
  <div class="footer-container">
    <!-- Контактная информация -->
    <div class="footer-section">
      <h4>Контакты</h4>
      <p><strong>Адрес:</strong><br>г. Москва, Бутово,<br>ул. Адмирала Лазарева, д. 63</p>
      <p><strong>Телефон:</strong><br><a href="tel:+74951234567">+7 (495) 123-45-67</a></p>
      <p><strong>Email:</strong><br><a href="mailto:info@mebeldom.ru">info@mebeldom.ru</a></p>
    </div>

    <!-- Режим работы -->
    <div class="footer-section">
      <h4>Режим работы</h4>
      <p><strong>Пн-Пт:</strong> 9:00 - 20:00</p>
      <p><strong>Сб-Вс:</strong> 10:00 - 18:00</p>
      <p>Без перерыва на обед</p>
    </div>

    <!-- Навигация -->
    <div class="footer-section">
      <h4>Навигация</h4>
      <ul>
        <li><a href="index.html">Главная</a></li>
        <li><a href="catalog.html">Каталог мебели</a></li>
        <li><a href="contacts.html">Контакты</a></li>
        <li><a href="about.html">О компании</a></li>
        <li><a href="delivery.html">Доставка и сборка</a></li>
      </ul>
    </div>

    <!-- Социальные сети -->
    <div class="footer-section">
      <h4>Мы в соцсетях</h4>
      <div class="social-links">
        <a href="https://vk.com/mebeldom" aria-label="ВКонтакте" target="_blank">VK</a>
        <a href="https://t.me/mebeldom" aria-label="Telegram" target="_blank">TG</a>
        <a href="https://wa.me/79991234567" aria-label="WhatsApp" target="_blank">WA</a>
        <a href="https://instagram.com/mebeldom" aria-label="Instagram" target="_blank">IG</a>
      </div>
      <p style="margin-top: 15px; font-size: 14px; color: #999;">
        Подписывайтесь на наши новости и акции
      </p>
    </div>

    <!-- Копирайт и юридическая информация -->
    <div class="footer-bottom">
      <div class="copyright">
        © 2025 ООО "Мебельный Дом". Все права защищены.<br>
        ИНН: 1234567890 | ОГРН: 1234567890123
      </div>
      <div class="legal-links">
        <a href="privacy.html">Политика конфиденциальности</a>
        <a href="terms.html">Пользовательское соглашение</a>
        <a href="return.html">Условия возврата</a>
      </div>
    </div>
  </div>
</footer>

<script src="js/auth.js"></script>
<script>

// Инициализация слайдера ассортимента
function initAssortmentSlider() {
  const track = document.getElementById('assortmentTrack');
  const dotsContainer = document.getElementById('assortmentDots');
  const prevBtn = document.getElementById('assortmentPrevBtn');
  const nextBtn = document.getElementById('assortmentNextBtn');
  
  // Данные о товарах
  const productsData = [
    {
      id: 1,
      name: "Современные кровати",
      description: "Удобные и стильные кровати с ортопедическими матрасами для здорового сна",
      image: "./img/bed1.png",
      category: "bed"
    },
    {
      id: 2,
      name: "Вместительные шкафы",
      description: "Просторные шкафы для хранения одежды и аксессуаров с современным дизайном",
      image: "./img/wardrobe1.png",
      category: "wardrobe"
    },
    {
      id: 3,
      name: "Комфортные диваны",
      description: "Мягкие и практичные диваны для гостиной, доступные в различных цветах и размерах",
      image: "./img/sofa1.png",
      category: "sofa"
    },
    {
      id: 4,
      name: "Обеденные столы",
      description: "Элегантные столы для семейных обедов и приема гостей из натуральных материалов",
      image: "./img/stol.png",
      category: "table"
    },
    {
      id: 5,
      name: "Комоды и тумбы",
      description: "Функциональные комоды для хранения вещей с эргономичным дизайном",
      image: "./img/comod.png",
      category: "chest"
    }
  ];
  
  let currentSlide = 0;
  let autoSlideInterval;
  
  // Создание слайдов
  function createSlides() {
    track.innerHTML = '';
    dotsContainer.innerHTML = '';
    
    productsData.forEach((product, index) => {
      // Создание слайда
      const slide = document.createElement('div');
      slide.className = 'product-slide';
      slide.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="product-image">
        <div class="product-info">
          <h4 class="product-name">${product.name}</h4>
          <p class="product-description">${product.description}</p>
        </div>
      `;
      track.appendChild(slide);
      
      // Создание точки навигации
      const dot = document.createElement('button');
      dot.className = `assortment-dot ${index === 0 ? 'active' : ''}`;
      dot.setAttribute('aria-label', `Перейти к товару ${index + 1}`);
      dot.addEventListener('click', () => goToSlide(index));
      dotsContainer.appendChild(dot);
    });
  }
  
  // Переход к конкретному слайду
  function goToSlide(slideIndex) {
    currentSlide = slideIndex;
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    
    // Обновление активной точки
    document.querySelectorAll('.assortment-dot').forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
  }
  
  // Следующий слайд
  function nextSlide() {
    if (currentSlide < productsData.length - 1) {
      goToSlide(currentSlide + 1);
    } else {
      goToSlide(0);
    }
  }
  
  // Предыдущий слайд
  function prevSlide() {
    if (currentSlide > 0) {
      goToSlide(currentSlide - 1);
    } else {
      goToSlide(productsData.length - 1);
    }
  }
  
  // Автоматическое перелистывание
  function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
      nextSlide();
    }, 4000); // Меняем слайд каждые 4 секунды
  }
  
  // Остановка автоматического перелистывания при взаимодействии
  function stopAutoSlide() {
    clearInterval(autoSlideInterval);
  }
  
  // Инициализация событий
  prevBtn.addEventListener('click', () => {
    prevSlide();
    stopAutoSlide();
    startAutoSlide();
  });
  
  nextBtn.addEventListener('click', () => {
    nextSlide();
    stopAutoSlide();
    startAutoSlide();
  });
  
  // Свайпы для мобильных устройств
  let startX = 0;
  track.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    stopAutoSlide();
  });
  
  track.addEventListener('touchend', (e) => {
    const endX = e.changedTouches[0].clientX;
    const diff = startX - endX;
    
    if (Math.abs(diff) > 50) {
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
    }
    startAutoSlide();
  });
  
  // Запуск инициализации
  createSlides();
  startAutoSlide();
}

// Инициализация слайдера отзывов
async function initReviewsSlider() {
  const track = document.getElementById('reviewsTrack');
  const dotsContainer = document.getElementById('reviewsDots');
  const prevBtn = document.getElementById('reviewsPrevBtn');
  const nextBtn = document.getElementById('reviewsNextBtn');
  
  let reviewsData = [];
  let currentSlide = 0;
  
  try {
    // Загружаем отзывы с бэкенда
    const response = await fetch('http://localhost:8001/api/reviews');
    if (response.ok) {
      reviewsData = await response.json();
    } else {
      console.error('Ошибка при загрузке отзывов');
    }
  } catch (error) {
    console.error('Ошибка при загрузке отзывов:', error);
  }
  
  // Если нет отзывов, покажем заглушку
  if (reviewsData.length === 0) {
    track.innerHTML = '<div class="review-slide"><p>Пока нет отзывов. Будьте первым!</p></div>';
    dotsContainer.innerHTML = '';
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    return;
  }
  
  // Функция для преобразования рейтинга в звёзды
  function getRatingStars(rating) {
    const fullStar = '★';
    const emptyStar = '☆';
    return fullStar.repeat(rating) + emptyStar.repeat(5 - rating);
  }
  
  // Функция для форматирования даты
  function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('ru-RU', options);
  }
  
  // Создание слайдов
  function createSlides() {
    track.innerHTML = '';
    dotsContainer.innerHTML = '';
    
    reviewsData.forEach((review, index) => {
      // Создание слайда
      const slide = document.createElement('div');
      slide.className = 'review-slide';
      slide.innerHTML = `
        <div class="review-header">
          <div class="review-avatar">
            ${review.user_name.charAt(0)}
          </div>
          <div class="review-info">
            <h4 class="review-author">${review.user_name}</h4>
            <p class="review-date">${formatDate(review.created_at)}</p>
          </div>
        </div>
        <div class="review-rating">${getRatingStars(review.rating)}</div>
        <p class="review-text">${review.text}</p>
      `;
      track.appendChild(slide);
      
      // Создание точки навигации
      const dot = document.createElement('button');
      dot.className = `reviews-dot ${index === 0 ? 'active' : ''}`;
      dot.setAttribute('aria-label', `Перейти к отзыву ${index + 1}`);
      dot.addEventListener('click', () => goToSlide(index));
      dotsContainer.appendChild(dot);
    });
  }
  
  // Переход к конкретному слайду
  function goToSlide(slideIndex) {
    currentSlide = slideIndex;
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    
    // Обновление активной точки
    document.querySelectorAll('.reviews-dot').forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
    
    // Обновление состояния кнопок
    updateButtons();
  }
  
  // Обновление состояния кнопок навигации
  function updateButtons() {
    prevBtn.disabled = currentSlide === 0;
    nextBtn.disabled = currentSlide === reviewsData.length - 1;
  }
  
  // Следующий слайд
  function nextSlide() {
    if (currentSlide < reviewsData.length - 1) {
      goToSlide(currentSlide + 1);
    }
  }
  
  // Предыдущий слайд
  function prevSlide() {
    if (currentSlide > 0) {
      goToSlide(currentSlide - 1);
    }
  }
  
  // Инициализация событий
  prevBtn.addEventListener('click', prevSlide);
  nextBtn.addEventListener('click', nextSlide);
  
  // Свайпы для мобильных устройств
  let startX = 0;
  track.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
  });
  
  track.addEventListener('touchend', (e) => {
    const endX = e.changedTouches[0].clientX;
    const diff = startX - endX;
    
    if (Math.abs(diff) > 50) {
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
    }
  });
  
  // Запуск инициализации
  createSlides();
  updateButtons();
}

// Запуск слайдеров после загрузки DOM
document.addEventListener('DOMContentLoaded', function() {
  initAssortmentSlider();
  initReviewsSlider();
  
  // Остальной ваш код...
  const inlineNav = document.querySelectorAll('.nav-inline .nav-btn');
  const mobileNav = document.querySelectorAll('.mobile-nav .nav-btn');
  const allNavBtns = [...inlineNav, ...mobileNav];
  const authControls = document.getElementById('authControls');
  const content = document.getElementById('content');

  const authModal = document.getElementById('authModal');
  const authModalTabs = document.querySelectorAll('.auth-modal-tab');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');

  let state = {
    currentPage: 'home',
    isAuthenticated: false,
    userData: null
  };

  function checkAuth() {
    const savedAuth = localStorage.getItem('mebeldom_auth');
    if (savedAuth) {
      try {
        const authData = JSON.parse(savedAuth);
        if (authData && (authData.access_token || authData.email || authData.name)) {
          state.isAuthenticated = true;
          state.userData = authData;
          console.log('User authenticated on index:', authData);
        }
      } catch (error) {
        console.error('Error parsing auth data:', error);
        localStorage.removeItem('mebeldom_auth');
      }
    }
    renderAuth();
  }

  function renderAuth(){
    authControls.innerHTML = '';
    if(state.isAuthenticated){
      const name = document.createElement('span');
      name.className = 'username';
      
      let userName = 'Пользователь';
      if (state.userData) {
        if (state.userData.full_name) {
          userName = state.userData.full_name;
        } else if (state.userData.name) {
          userName = state.userData.name;
        } else if (state.userData.email) {
          userName = state.userData.email.split('@')[0];
        }
      }
      
      name.textContent = userName;
      name.style.color = 'var(--brand-red)';
      name.style.fontWeight = '600';
      name.style.marginRight = '8px';

      const btn = document.createElement('button');
      btn.className = 'auth-ghost';
      btn.textContent = 'Выйти';
      btn.addEventListener('click', () => {
        logout();
      });

      authControls.appendChild(name);
      authControls.appendChild(btn);
    } else {
      const btn = document.createElement('button');
      btn.className = 'auth-ghost';
      btn.textContent = 'Войти';
      btn.addEventListener('click', () => {
        openAuthModal();
      });
      authControls.appendChild(btn);
    }
  }

  function openAuthModal() {
    authModal.classList.add('active');
    loginForm.reset();
    registerForm.reset();
    switchAuthTab('login');
  }

  function closeAuthModal() {
    authModal.classList.remove('active');
  }

  function switchAuthTab(tabName) {
    authModalTabs.forEach(tab => {
      if (tab.dataset.tab === tabName) {
        tab.classList.add('active');
      } else {
        tab.classList.remove('active');
      }
    });
    
    if (tabName === 'login') {
      loginForm.style.display = 'block';
      registerForm.style.display = 'none';
    } else {
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
    }
  }

  function login(userData) {
    state.isAuthenticated = true;
    state.userData = userData;
    localStorage.setItem('mebeldom_auth', JSON.stringify(userData));
    renderAuth();
    closeAuthModal();
  }

  function logout() {
    state.isAuthenticated = false;
    state.userData = null;
    localStorage.removeItem('mebeldom_auth');
    renderAuth();
  }

  function setPage(page){
    state.currentPage = page;
    allNavBtns.forEach(b => {
      if(b.dataset.page === page){
        b.setAttribute('aria-current','page');
      } else {
        b.removeAttribute('aria-current');
      }
    });
    
    if (content) content.scrollIntoView({behavior:'smooth', block:'start'});
  }

  // Обработчики событий для модального окна авторизации
  authModalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      switchAuthTab(tab.dataset.tab);
    });
  });

  authModal.addEventListener('click', (e) => {
    if (e.target === authModal) {
      closeAuthModal();
    }
  });

  // Обработка формы входа
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    if (email && password) {
      const userData = {
        name: email.split('@')[0],
        email: email
      };
      
      login(userData);
      alert('Вы успешно вошли в систему!');
    } else {
      alert('Пожалуйста, заполните все поля');
    }
  });

  // Обработка формы регистрации
  registerForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;
    const privacyPolicy = document.getElementById('privacyPolicy').checked;
    const dataStorage = document.getElementById('dataStorage').checked;
    
    if (!name || !email || !password || !confirmPassword) {
      alert('Пожалуйста, заполните все поля');
      return;
    }
    
    if (password !== confirmPassword) {
      alert('Пароли не совпадают');
      return;
    }
    
    if (!privacyPolicy || !dataStorage) {
      alert('Необходимо согласие со всеми условиями');
      return;
    }
    
    const userData = {
      name: name,
      email: email
    };
    
    login(userData);
    alert('Регистрация прошла успешно! Вы вошли в систему.');
  });

  // Навигация
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.nav-btn');
    if(btn) {
      const page = btn.dataset.page;
      if(page) setPage(page);
    }
  });

  document.getElementById('brand').addEventListener('click', () => setPage('home'));
  document.getElementById('brand').addEventListener('keydown', (e) => { 
    if(e.key === 'Enter') setPage('home'); 
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeAuthModal();
    }
  });

  checkAuth();
  setPage(state.currentPage);

  window.appHeader = { state, setPage, renderAuth };
});
</script>
</body>
</html>