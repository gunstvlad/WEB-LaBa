<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Мебельный магазин</title>
<link rel="stylesheet" href="css/index.css">
<style>
  /* Стили для слайдера отзывов */
  .reviews-section {
    margin: 60px 0;
  }
  
  .reviews-section h3 {
    text-align: center;
    margin-bottom: 8px;
    color: #0f172a;
    font-size: 28px;
  }
  
  .reviews-lead {
    text-align: center;
    color: #64748b;
    margin-bottom: 40px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .reviews-slider {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
    overflow: hidden;
    border-radius: 12px;
  }
  
  .reviews-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }
  
  .review-slide {
    flex: 0 0 100%;
    padding: 30px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    box-sizing: border-box;
  }
  
  .review-header {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
  }
  
  .review-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 16px;
    border: 2px solid var(--brand-red);
  }
  
  .review-info {
    flex: 1;
  }
  
  .review-author {
    font-weight: 600;
    color: #0f172a;
    margin: 0 0 4px 0;
  }
  
  .review-date {
    color: #64748b;
    font-size: 14px;
    margin: 0;
  }
  
  .review-rating {
    color: #f59e0b;
    font-size: 18px;
    margin-bottom: 12px;
  }
  
  .review-text {
    color: #475569;
    line-height: 1.6;
    margin: 0;
    font-style: italic;
  }
  
  .slider-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
  }
  
  .slider-btn {
    background: var(--brand-red);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s ease;
  }
  
  .slider-btn:hover {
    background: #b3151a;
    transform: scale(1.1);
  }
  
  .slider-btn:disabled {
    background: #cbd5e1;
    cursor: not-allowed;
    transform: none;
  }
  
  .slider-dots {
    display: flex;
    gap: 8px;
  }
  
  .slider-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #cbd5e1;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  
  .slider-dot.active {
    background: var(--brand-red);
  }
  
  @media (max-width: 768px) {
    .review-slide {
      padding: 20px;
    }
    
    .review-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .review-avatar {
      margin-right: 0;
      margin-bottom: 12px;
    }
  }
</style>
</head>
<body>

<header class="site-header" role="banner">
  <div class="container">
    <div class="top-row">
      <div style="display:flex;align-items:center;gap:18px;min-width:0;">
        <div class="brand" id="brand" tabindex="0" title="Перейти на главную">
          <img src="./img/logo.png" alt="Логотип — Мебельный Дом" id="logo" />
          <div class="title">Мебельный Дом</div>
        </div>

        <nav class="nav-inline" aria-label="Основная навигация">
            <a href="index.html" class="nav-btn" data-page="home" aria-current="page">Главная</a>
            <a href="catalog.html" class="nav-btn" data-page="catalog">Каталог</a>
            <a href="contacts.html" class="nav-btn" data-page="contacts">Контакты</a>
            <a href="profile.html" class="nav-btn" data-page="profile">Профиль</a>
            <a href="cart.html" class="nav-btn" data-page="cart">Корзина</a>
        </nav>
      </div>

      <div class="controls" id="authControls">
        <!-- JS заполнит -->
      </div>
    </div>

    <nav class="mobile-nav" id="mobileNav" aria-label="Мобильная навигация">
      <a href="index.html" class="nav-btn" data-page="home" aria-current="page">Главная</a>
      <a href="catalog.html" class="nav-btn" data-page="catalog">Каталог</a>
      <a href="contacts.html" class="nav-btn" data-page="contacts">Контакты</a>
      <a href="profile.html" class="nav-btn" data-page="profile">Профиль</a>
      <a href="cart.html" class="nav-btn" data-page="cart">Корзина</a>
    </nav>
  </div>
</header>

<!-- Модальное окно авторизации -->
<div class="auth-modal-overlay" id="authModal">
  <div class="auth-modal">
    <div class="auth-modal-header">
      <button class="auth-modal-tab active" data-tab="login">Вход</button>
      <button class="auth-modal-tab" data-tab="register">Регистрация</button>
    </div>
    
    <div class="auth-modal-content">
      <!-- Форма входа -->
      <form id="loginForm" style="display: block;">
        <div class="form-group">
          <label for="loginEmail" class="form-label">Email</label>
          <input type="email" id="loginEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword" class="form-label">Пароль</label>
          <input type="password" id="loginPassword" class="form-input" placeholder="Введите пароль" required>
        </div>
        
        <button type="submit" class="form-submit">Войти</button>
      </form>

      <form id="registerForm" style="display: none;">
        <div class="form-group">
          <label for="registerName" class="form-label">ФИО</label>
          <input type="text" id="registerName" class="form-input" placeholder="Иван Иванов" required>
        </div>
        
        <div class="form-group">
          <label for="registerPhone" class="form-label">Телефон</label>
          <input type="tel" id="registerPhone" class="form-input" placeholder="+7 (900) 000-00-00" required>
        </div>
        
        <div class="form-group">
          <label for="registerEmail" class="form-label">Email</label>
          <input type="email" id="registerEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="registerPassword" class="form-label">Пароль</label>
          <input type="password" id="registerPassword" class="form-input" placeholder="Придумайте пароль" required>
        </div>
        
        <div class="form-group">
          <label for="registerConfirmPassword" class="form-label">Подтвердите пароль</label>
          <input type="password" id="registerConfirmPassword" class="form-input" placeholder="Повторите пароль" required>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="privacyPolicy" class="checkbox" required>
          <label for="privacyPolicy" class="checkbox-label">
            Я соглашаюсь с <a href="#">политикой конфиденциальности</a> и даю согласие на обработку персональных данных
          </label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="dataStorage" class="checkbox" required>
          <label for="dataStorage" class="checkbox-label">
            Я соглашаюсь на хранение и обработку моих персональных данных
          </label>
        </div>
        
        <button type="submit" class="form-submit">Зарегистрироваться</button>
      </form>
    </div>
  </div>
</div>

<main class="container" style="padding:34px 18px;">
  <div id="content" style="margin-top:12px;padding:18px;background:white;border-radius:10px;box-shadow:0 6px 16px rgba(2,6,23,0.06);min-height:120px;">
    <!-- ===== About section ===== -->
    <section aria-label="О нас">
        <div class="about-row">
            <div class="about-text">
            <h3>О нас</h3>
            <p><strong>Мы — команда профессионалов</strong> с многолетним опытом в производстве качественной мебели. Каждое изделие создаётся с любовью к деталям и заботой о комфорте наших клиентов.</p>
            <p>Вы можете довериться нашему вкусу: мы постоянно развиваемся, совершенствуем процессы и используем только проверенные материалы. Наша цель — сделать ваш дом уютнее.</p>
            </div>

            <div class="about-card">
            <div class="about-image">
                <img src="./img/divan.png" alt="Диван" style="display:block;width:100%;height:auto;object-fit:cover;">
            </div>
            </div>
        </div>

        <!-- features -->
        <div class="features" role="region" aria-label="Наши преимущества">
            <div class="lead">
            <h4 style="margin:0 0 8px;color:#0f172a;font-size:16px">История</h4>
            <p style="margin:0;color:#64748b">Наша компания существует долгое время и за годы работы мы накопили опыт и знания, которые помогают создавать идеальную мебель для вашего дома.</p>
            </div>

            <div class="features-grid">
                <div class="feature g-blue" role="article" aria-label="Качество">
                    <div class="icon ic-blue">✓</div>
                    <div class="f-body">
                    <div class="f-title">Качество</div>
                    <div class="f-desc">Используем только лучшие материалы и строгий контроль на каждом этапе.</div>
                    </div>
                </div>

                <div class="feature g-purple" role="article" aria-label="Дизайн">
                    <div class="icon ic-purple">★</div>
                    <div class="f-body">
                    <div class="f-title">Дизайн</div>
                    <div class="f-desc">Современные и стильные решения — подберём вариант под ваш интерьер.</div>
                    </div>
                </div>

                <div class="feature g-green" role="article" aria-label="Сервис">
                    <div class="icon ic-green">❤</div>
                    <div class="f-body">
                    <div class="f-title">Сервис</div>
                    <div class="f-desc">Полное сопровождение: доставка, сборка и поддержка после покупки.</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== Reviews Slider Section ===== -->

    <!-- ===== Team Section ===== -->
    <section class="team-section" aria-label="Наша команда">
        <h3>Наша команда</h3>
        <p class="lead">Люди, которые делают вашу мебель с любовью и вниманием к деталям</p>

        <div class="team-grid">
            <div class="team-card">
            <img src="./img/profile1.png" alt="Иван Иванов">
            <div class="team-info">
                <div class="team-name">Иван Иванов</div>
                <div class="team-role">Дизайнер интерьеров</div>
            </div>
            </div>

            <div class="team-card">
            <img src="./img/profile2.png" alt="Мария Петрова">
            <div class="team-info">
                <div class="team-name">Мария Петрова</div>
                <div class="team-role">Менеджер по продажам</div>
            </div>
            </div>

            <div class="team-card">
            <img src="./img/profile3.png" alt="Алексей Сидоров">
            <div class="team-info">
                <div class="team-name">Алексей Сидоров</div>
                <div class="team-role">Мастер-изготовитель</div>
            </div>
            </div>
        </div>
    </section>
    <section class="reviews-section" aria-label="Отзывы клиентов">
      <h3>Отзывы наших клиентов</h3>
      <p class="reviews-lead">Узнайте, что говорят о нас люди, которые уже обустроили свой дом с нашей мебелью</p>
      
      <div class="reviews-slider">
        <div class="reviews-track" id="reviewsTrack">
          <!-- Отзывы будут добавлены через JavaScript -->
        </div>
      </div>
      
      <div class="slider-controls">
        <button class="slider-btn" id="prevBtn" aria-label="Предыдущий отзыв">‹</button>
        
        <div class="slider-dots" id="sliderDots">
          <!-- Точки навигации будут добавлены через JavaScript -->
        </div>
        
        <button class="slider-btn" id="nextBtn" aria-label="Следующий отзыв">›</button>
      </div>
    </section>
  </div>
</main>

<footer class="site-footer" role="contentinfo">
  <div class="container footer-inner">
    <div>
      <strong>Мебельный Дом</strong><br/>
      <span class="small">© 2025 — Все права защищены</span>
    </div>
    <div class="small">Контакты: info@example.com • +7 (900) 000-00-00</div>
  </div>
</footer>

<script src="js/auth.js"></script>
<script>

// Инициализация слайдера
async function initReviewsSlider() {
  const track = document.getElementById('reviewsTrack');
  const dotsContainer = document.getElementById('sliderDots');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  
  let reviewsData = [];
  let currentSlide = 0;
  
  try {
    // Загружаем отзывы с бэкенда
    const response = await fetch('http://localhost:8001/api/reviews');
    if (response.ok) {
      reviewsData = await response.json();
    } else {
      console.error('Ошибка при загрузке отзывов');
    }
  } catch (error) {
    console.error('Ошибка при загрузке отзывов:', error);
  }
  
  // Если нет отзывов, покажем заглушку
  if (reviewsData.length === 0) {
    track.innerHTML = '<div class="review-slide"><p>Пока нет отзывов. Будьте первым!</p></div>';
    dotsContainer.innerHTML = '';
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    return;
  }
  
  // Функция для преобразования рейтинга в звёзды
  function getRatingStars(rating) {
    const fullStar = '★';
    const emptyStar = '☆';
    return fullStar.repeat(rating) + emptyStar.repeat(5 - rating);
  }
  
  // Функция для форматирования даты
  function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('ru-RU', options);
  }
  
  // Создание слайдов
  function createSlides() {
    track.innerHTML = '';
    dotsContainer.innerHTML = '';
    
    reviewsData.forEach((review, index) => {
      // Создание слайда
      const slide = document.createElement('div');
      slide.className = 'review-slide';
      slide.innerHTML = `
        <div class="review-header">
          <div class="review-avatar" style="background-color: #d77272; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px;">
            ${review.user_name.charAt(0)}
          </div>
          <div class="review-info">
            <h4 class="review-author">${review.user_name}</h4>
            <p class="review-date">${formatDate(review.created_at)}</p>
          </div>
        </div>
        <div class="review-rating">${getRatingStars(review.rating)}</div>
        <p class="review-text">${review.text}</p>
      `;
      track.appendChild(slide);
      
      // Создание точки навигации
      const dot = document.createElement('button');
      dot.className = `slider-dot ${index === 0 ? 'active' : ''}`;
      dot.setAttribute('aria-label', `Перейти к отзыву ${index + 1}`);
      dot.addEventListener('click', () => goToSlide(index));
      dotsContainer.appendChild(dot);
    });
  }
  
  // Переход к конкретному слайду
  function goToSlide(slideIndex) {
    currentSlide = slideIndex;
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    
    // Обновление активной точки
    document.querySelectorAll('.slider-dot').forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
    
    // Обновление состояния кнопок
    updateButtons();
  }
  
  // Обновление состояния кнопок навигации
  function updateButtons() {
    prevBtn.disabled = currentSlide === 0;
    nextBtn.disabled = currentSlide === reviewsData.length - 1;
  }
  
  // Следующий слайд
  function nextSlide() {
    if (currentSlide < reviewsData.length - 1) {
      goToSlide(currentSlide + 1);
    }
  }
  
  // Предыдущий слайд
  function prevSlide() {
    if (currentSlide > 0) {
      goToSlide(currentSlide - 1);
    }
  }
  
  
  // Инициализация событий
  prevBtn.addEventListener('click', prevSlide);
  nextBtn.addEventListener('click', nextSlide);
  
  // Свайпы для мобильных устройств
  let startX = 0;
  track.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
  });
  
  track.addEventListener('touchend', (e) => {
    const endX = e.changedTouches[0].clientX;
    const diff = startX - endX;
    
    if (Math.abs(diff) > 50) { // Минимальное расстояние свайпа
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
    }
  });
  
  // Запуск инициализации
  createSlides();
  updateButtons();
}

// Запуск слайдера после загрузки DOM
document.addEventListener('DOMContentLoaded', function() {
  initReviewsSlider();
  
  // Остальной ваш код...
  const inlineNav = document.querySelectorAll('.nav-inline .nav-btn');
  const mobileNav = document.querySelectorAll('.mobile-nav .nav-btn');
  const allNavBtns = [...inlineNav, ...mobileNav];
  const authControls = document.getElementById('authControls');
  const content = document.getElementById('content');

  const authModal = document.getElementById('authModal');
  const authModalTabs = document.querySelectorAll('.auth-modal-tab');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');

  let state = {
    currentPage: 'home',
    isAuthenticated: false,
    userData: null
  };

  function checkAuth() {
    const savedAuth = localStorage.getItem('mebeldom_auth');
    if (savedAuth) {
      try {
        const authData = JSON.parse(savedAuth);
        if (authData && (authData.access_token || authData.email || authData.name)) {
          state.isAuthenticated = true;
          state.userData = authData;
          console.log('User authenticated on index:', authData);
        }
      } catch (error) {
        console.error('Error parsing auth data:', error);
        localStorage.removeItem('mebeldom_auth');
      }
    }
    renderAuth();
  }

  function renderAuth(){
    authControls.innerHTML = '';
    if(state.isAuthenticated){
      const name = document.createElement('span');
      name.className = 'username';
      
      let userName = 'Пользователь';
      if (state.userData) {
        if (state.userData.full_name) {
          userName = state.userData.full_name;
        } else if (state.userData.name) {
          userName = state.userData.name;
        } else if (state.userData.email) {
          userName = state.userData.email.split('@')[0];
        }
      }
      
      name.textContent = userName;
      name.style.color = 'var(--brand-red)';
      name.style.fontWeight = '600';
      name.style.marginRight = '8px';

      const btn = document.createElement('button');
      btn.className = 'auth-ghost';
      btn.textContent = 'Выйти';
      btn.addEventListener('click', () => {
        logout();
      });

      authControls.appendChild(name);
      authControls.appendChild(btn);
    } else {
      const btn = document.createElement('button');
      btn.className = 'auth-ghost';
      btn.textContent = 'Войти';
      btn.addEventListener('click', () => {
        openAuthModal();
      });
      authControls.appendChild(btn);
    }
  }

  function openAuthModal() {
    authModal.classList.add('active');
    loginForm.reset();
    registerForm.reset();
    switchAuthTab('login');
  }

  function closeAuthModal() {
    authModal.classList.remove('active');
  }

  function switchAuthTab(tabName) {
    authModalTabs.forEach(tab => {
      if (tab.dataset.tab === tabName) {
        tab.classList.add('active');
      } else {
        tab.classList.remove('active');
      }
    });
    
    if (tabName === 'login') {
      loginForm.style.display = 'block';
      registerForm.style.display = 'none';
    } else {
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
    }
  }

  function login(userData) {
    state.isAuthenticated = true;
    state.userData = userData;
    localStorage.setItem('mebeldom_auth', JSON.stringify(userData));
    renderAuth();
    closeAuthModal();
  }

  function logout() {
    state.isAuthenticated = false;
    state.userData = null;
    localStorage.removeItem('mebeldom_auth');
    renderAuth();
  }

  function setPage(page){
    state.currentPage = page;
    allNavBtns.forEach(b => {
      if(b.dataset.page === page){
        b.setAttribute('aria-current','page');
      } else {
        b.removeAttribute('aria-current');
      }
    });
    
    if (content) content.scrollIntoView({behavior:'smooth', block:'start'});
  }

  // Обработчики событий для модального окна авторизации
  authModalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      switchAuthTab(tab.dataset.tab);
    });
  });

  authModal.addEventListener('click', (e) => {
    if (e.target === authModal) {
      closeAuthModal();
    }
  });

  // Обработка формы входа
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    if (email && password) {
      const userData = {
        name: email.split('@')[0],
        email: email
      };
      
      login(userData);
      alert('Вы успешно вошли в систему!');
    } else {
      alert('Пожалуйста, заполните все поля');
    }
  });

  // Обработка формы регистрации
  registerForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;
    const privacyPolicy = document.getElementById('privacyPolicy').checked;
    const dataStorage = document.getElementById('dataStorage').checked;
    
    if (!name || !email || !password || !confirmPassword) {
      alert('Пожалуйста, заполните все поля');
      return;
    }
    
    if (password !== confirmPassword) {
      alert('Пароли не совпадают');
      return;
    }
    
    if (!privacyPolicy || !dataStorage) {
      alert('Необходимо согласие со всеми условиями');
      return;
    }
    
    const userData = {
      name: name,
      email: email
    };
    
    login(userData);
    alert('Регистрация прошла успешно! Вы вошли в систему.');
  });

  // Навигация
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.nav-btn');
    if(btn) {
      const page = btn.dataset.page;
      if(page) setPage(page);
    }
  });

  document.getElementById('brand').addEventListener('click', () => setPage('home'));
  document.getElementById('brand').addEventListener('keydown', (e) => { 
    if(e.key === 'Enter') setPage('home'); 
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeAuthModal();
    }
  });

  checkAuth();
  setPage(state.currentPage);

  window.appHeader = { state, setPage, renderAuth };
});
</script>
</body>
</html>