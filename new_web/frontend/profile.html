<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî –ú–µ–±–µ–ª—å–Ω—ã–π –î–æ–º</title>
<link rel="stylesheet" href="css/profile.css">
<style>
  /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
  .auth-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--brand-red);
    color: white;
    padding: 12px 20px;
    border-radius: 4px;
    z-index: 10000;
    animation: slideInRight 0.3s ease;
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
</style>
</head>
<body>
<header class="site-header" role="banner">
  <div class="container">
    <div class="top-row">
      <div style="display:flex;align-items:center;gap:18px;min-width:0;">
        <div class="brand" id="brand" tabindex="0" title="–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é">
          <img src="./img/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø ‚Äî –ú–µ–±–µ–ª—å–Ω—ã–π –î–æ–º" id="logo" />
          <div class="title">–ú–µ–±–µ–ª—å–Ω—ã–π –î–æ–º</div>
        </div>

        <nav class="nav-inline" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
          <a href="index.html" class="nav-btn" data-page="home">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="catalog.html" class="nav-btn" data-page="catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
          <a href="contacts.html" class="nav-btn" data-page="contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
          <a href="profile.html" class="nav-btn" data-page="profile" aria-current="page">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="cart.html" class="nav-btn" data-page="cart">–ö–æ—Ä–∑–∏–Ω–∞</a>
        </nav>
      </div>

      <div class="controls" id="authControls">
        <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç -->
      </div>
    </div>

    <nav class="mobile-nav" id="mobileNav" aria-label="–ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
      <a href="index.html" class="nav-btn" data-page="home">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="catalog.html" class="nav-btn" data-page="catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
      <a href="contacts.html" class="nav-btn" data-page="contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      <a href="profile.html" class="nav-btn" data-page="profile" aria-current="page">–ü—Ä–æ—Ñ–∏–ª—å</a>
      <a href="cart.html" class="nav-btn" data-page="cart">–ö–æ—Ä–∑–∏–Ω–∞</a>
    </nav>
  </div>
</header>

<main class="container profile-container">
  <div id="content">
    <!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="profile-card" id="loginPrompt">
      <div class="profile-icon">
        üë§
      </div>
      <h1 class="profile-title">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</h1>
      <p class="profile-subtitle">–ß—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</p>
      <button class="login-btn" id="loginBtn">–í–æ–π—Ç–∏</button>
    </div>

    <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="profile-card user-profile" id="userProfile" style="display: none;">
      <div class="user-header">
        <div class="user-avatar" id="userAvatar">
          –ò–ò
        </div>
        <div class="user-info">
          <h2 id="userName">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</h2>
          <p id="userEmail">ivan@example.com</p>
        </div>
      </div>

      <div class="profile-section">
        <h3 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
        <div id="ordersList" class="orders-list">
          <!-- –ó–∞–∫–∞–∑—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>

      <div class="profile-section">
        <h3 class="section-title">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        <div id="wishlistContainer" class="wishlist-container">
          <!-- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>

      <button class="logout-btn" id="logoutBtn">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
    </div>
  </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<div class="auth-modal-overlay" id="authModal">
  <div class="auth-modal">
    <div class="auth-modal-header">
      <button class="auth-modal-tab active" data-tab="login">–í—Ö–æ–¥</button>
      <button class="auth-modal-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>
    
    <div class="auth-modal-content">
      <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
      <form id="loginForm" style="display: block;">
        <div class="form-group">
          <label for="loginEmail" class="form-label">Email</label>
          <input type="email" id="loginEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="loginPassword" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        </div>
        
        <button type="submit" class="form-submit">–í–æ–π—Ç–∏</button>
      </form>

      <form id="registerForm" style="display: none;">
        <div class="form-group">
          <label for="registerName" class="form-label">–§–ò–û</label>
          <input type="text" id="registerName" class="form-input" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" required>
        </div>
        
        <div class="form-group">
          <label for="registerPhone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
          <input type="tel" id="registerPhone" class="form-input" placeholder="+7 (900) 000-00-00">
        </div>
        
        <div class="form-group">
          <label for="registerEmail" class="form-label">Email</label>
          <input type="email" id="registerEmail" class="form-input" placeholder="example@mail.ru" required>
        </div>
        
        <div class="form-group">
          <label for="registerPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="registerPassword" class="form-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        </div>
        
        <div class="form-group">
          <label for="registerConfirmPassword" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
          <input type="password" id="registerConfirmPassword" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="privacyPolicy" class="checkbox" required>
          <label for="privacyPolicy" class="checkbox-label">
            –Ø —Å–æ–≥–ª–∞—à–∞—é—Å—å —Å <a href="#">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> –∏ –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          </label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="dataStorage" class="checkbox" required>
          <label for="dataStorage" class="checkbox-label">
            –Ø —Å–æ–≥–ª–∞—à–∞—é—Å—å –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          </label>
        </div>
        
        <button type="submit" class="form-submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </form>
    </div>
  </div>
</div>

<footer class="site-footer" role="contentinfo">
  <div class="container footer-inner">
    <div>
      <strong>–ú–µ–±–µ–ª—å–Ω—ã–π –î–æ–º</strong><br/>
      <span class="small">¬© 2025 ‚Äî –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</span>
    </div>
    <div class="small">–ö–æ–Ω—Ç–∞–∫—Ç—ã: info@mebeldom.ru ‚Ä¢ +7 (495) 123-45-67</div>
  </div>
</footer>

<script src="js/auth.js"></script>
<script src="js/cart.js"></script>
<script>
// –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è
class ProfileManager {
  constructor() {
    this.apiBase = 'http://localhost:8001/api';
    this.init();
  }

  init() {
    this.bindEvents();
    this.loadProfileData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    setInterval(() => {
      if (window.auth && window.auth.isUserAuthenticated()) {
        this.loadProfileData();
      }
    }, 3000);
  }

  bindEvents() {
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    if (loginBtn) {
      loginBtn.addEventListener('click', () => {
        if (window.auth) {
          window.auth.openAuthModal();
        }
      });
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        if (window.auth) {
          window.auth.logout();
          this.updateProfileDisplay();
        }
      });
    }
  }

  async loadProfileData() {
    if (!window.auth || !window.auth.isUserAuthenticated()) {
      this.updateProfileDisplay();
      return;
    }

    try {
      await Promise.all([
        this.loadOrders(),
        this.loadWishlist()
      ]);
      this.updateProfileDisplay();
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
    }
  }

  updateProfileDisplay() {
    const loginPrompt = document.getElementById('loginPrompt');
    const userProfile = document.getElementById('userProfile');
    const userName = document.getElementById('userName');
    const userEmail = document.getElementById('userEmail');
    const userAvatar = document.getElementById('userAvatar');

    if (window.auth && window.auth.isUserAuthenticated()) {
      const userData = window.auth.getUserData();
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      loginPrompt.style.display = 'none';
      userProfile.style.display = 'block';
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      if (userData) {
        const displayName = userData.full_name || userData.name || 
                           userData.email?.split('@')[0] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
        userName.textContent = displayName;
        userEmail.textContent = userData.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä (–ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –∏–º–µ–Ω–∏)
        if (userData.full_name) {
          const names = userData.full_name.split(' ');
          const initials = names.map(name => name.charAt(0)).join('').toUpperCase();
          userAvatar.textContent = initials;
        } else {
          userAvatar.textContent = displayName.charAt(0).toUpperCase();
        }
      }
    } else {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤–æ–π—Ç–∏
      loginPrompt.style.display = 'block';
      userProfile.style.display = 'none';
    }
  }

  async loadOrders() {
    const ordersList = document.getElementById('ordersList');
    if (!ordersList) return;

    try {
      const token = this.getAuthToken();
      if (!token) {
        ordersList.innerHTML = '<p style="color: var(--muted);">–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>';
        return;
      }

      const response = await fetch(`${this.apiBase}/orders/`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const orders = await response.json();
        this.renderOrders(orders);
      } else {
        ordersList.innerHTML = '<p style="color: var(--muted);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
      ordersList.innerHTML = '<p style="color: var(--muted);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤</p>';
    }
  }

  renderOrders(orders) {
    const ordersContainer = document.getElementById('ordersList');
    
    if (!orders || orders.length === 0) {
      ordersContainer.innerHTML = '<p style="color: var(--muted);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
      return;
    }

    ordersContainer.innerHTML = orders.map(order => `
      <div class="order-card">
        <div class="order-header">
          <div class="order-info">
            <strong>–ó–∞–∫–∞–∑ #${order.id}</strong>
            <span class="order-status ${order.status}">${this.getStatusText(order.status)}</span>
          </div>
          <div class="order-dates">
            <small>–°–æ–∑–¥–∞–Ω: ${new Date(order.created_at).toLocaleDateString('ru-RU')}</small>
            <div class="order-total">${order.total_amount} ‚ÇΩ</div>
          </div>
        </div>
        <div class="order-items">
          ${order.items.map(item => `
            <div class="order-item">
              <span class="item-name">${item.product_name}</span>
              <span class="item-quantity">${item.quantity} —à—Ç.</span>
              <span class="item-price">${item.product_price} ‚ÇΩ</span>
            </div>
          `).join('')}
        </div>
        <div class="order-address">
          <strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> ${order.shipping_address}
        </div>
      </div>
    `).join('');
  }

  async loadWishlist() {
    const wishlistContainer = document.getElementById('wishlistContainer');
    if (!wishlistContainer) return;

    try {
      const token = this.getAuthToken();
      if (!token) {
        wishlistContainer.innerHTML = '<p style="color: var(--muted);">–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>';
        return;
      }

      const response = await fetch(`${this.apiBase}/wishlist/`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const wishlist = await response.json();
        this.renderWishlist(wishlist);
      } else {
        wishlistContainer.innerHTML = '<p style="color: var(--muted);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</p>';
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
      wishlistContainer.innerHTML = '<p style="color: var(--muted);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</p>';
    }
  }

  renderWishlist(wishlist) {
    const wishlistContainer = document.getElementById('wishlistContainer');
    
    if (!wishlist || wishlist.length === 0) {
      wishlistContainer.innerHTML = '<p style="color: var(--muted);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</p>';
      return;
    }

    wishlistContainer.innerHTML = `
      <div class="wishlist-grid">
        ${wishlist.map(product => `
          <div class="wishlist-item" data-id="${product.id}">
            <div class="wishlist-item-image">
              <img src="${this.fixImageUrl(product.image_url)}" alt="${product.name}" 
                   onerror="this.onerror=null; this.src='./img/placeholder.jpg';">
            </div>
            <div class="wishlist-item-info">
              <h4 class="wishlist-item-name">${product.name}</h4>
              <div class="wishlist-item-price">${product.price} ‚ÇΩ</div>
              <div class="wishlist-item-category">${this.getCategoryName(product.category)}</div>
            </div>
            <div class="wishlist-item-actions">
              <button class="wishlist-remove-btn" onclick="profileManager.removeFromWishlist(${product.id})">
                ‚ùå –£–¥–∞–ª–∏—Ç—å
              </button>
              <button class="wishlist-add-to-cart-btn" onclick="profileManager.addToCartFromWishlist(${product.id})">
                üõí –í –∫–æ—Ä–∑–∏–Ω—É
              </button>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  }

  async removeFromWishlist(productId) {
    try {
      const token = this.getAuthToken();
      if (!token) {
        alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
        return;
      }

      const response = await fetch(`${this.apiBase}/wishlist/${productId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        this.loadWishlist();
        this.showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
    }
  }

  async addToCartFromWishlist(productId) {
    try {
      if (window.cartManager) {
        const success = await window.cartManager.addToCart(productId, 1);
        if (success) {
          this.showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
        }
      } else {
        alert('–û—à–∏–±–∫–∞: –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É:', error);
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }
  }

  getStatusText(status) {
    const statusMap = {
      'pending': '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',
      'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
      'shipped': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
      'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
      'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
    };
    return statusMap[status] || status;
  }

  getCategoryName(category) {
    const categoryMap = {
      'sofa': '–î–∏–≤–∞–Ω—ã',
      'bed': '–ö—Ä–æ–≤–∞—Ç–∏',
      'wardrobe': '–®–∫–∞—Ñ—ã'
    };
    return categoryMap[category] || category;
  }

  fixImageUrl(imageUrl) {
    if (!imageUrl) return './img/placeholder.jpg';
    
    if (imageUrl.startsWith('/')) {
      return '.' + imageUrl;
    }
    
    if (imageUrl.startsWith('./')) {
      return imageUrl;
    }
    
    if (!imageUrl.startsWith('http') && !imageUrl.startsWith('./') && !imageUrl.startsWith('/')) {
      return './' + imageUrl;
    }
    
    return imageUrl;
  }

  getAuthToken() {
    if (window.auth && window.auth.getAuthToken) {
      return window.auth.getAuthToken();
    }
    
    const raw = localStorage.getItem('mebeldom_auth');
    if (!raw) return null;
    
    try {
      const user = JSON.parse(raw);
      return user.token || user.access_token;
    } catch {
      return null;
    }
  }

  showNotification(message) {
    const existingNotifications = document.querySelectorAll('.profile-notification');
    existingNotifications.forEach(notification => notification.remove());

    const notification = document.createElement('div');
    notification.className = 'profile-notification';
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--brand-red);
      color: white;
      padding: 12px 20px;
      border-radius: 4px;
      z-index: 10000;
      animation: slideInRight 0.3s ease;
    `;

    document.body.appendChild(notification);

    setTimeout(() => notification.remove(), 3000);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
  console.log('üë§ PROFILE: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è');
  window.profileManager = new ProfileManager();
});
</script>
</body>
</html>